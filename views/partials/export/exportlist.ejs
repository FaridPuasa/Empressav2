<div class="container-fluid">

    <!-- DataTales Example -->
<div class="card shadow mb-4">
<div class="card-header py-3">
<h6 class="m-0 font-weight-bold text-primary text-center">Finance Summary</h6>
</div>

<div class="card-body">
<!-- Outer Row -->
<div class="row justify-content-center">
<div class="col-xl-10 col-lg-12 col-md-9">
    <form class="user" method="POST" action="/itemInSuccess">
        
            <div id="toolbar">
                <!--<div class="d-flex justify-content-center">
                <button type="button" class="btn btn-light btn-lg ">Excel Upload</button>
                    <div class="dropdown-container">
                        <button class="btn btn-light dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fas fa-sliders-h"></i> Advance Search</button>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <div class="dropdown-list">
                                    <input id="search_input" type="search" placeholder="Search states" class="dropdown-search"/>
                                    <ul></ul>
                            </div>
                        </div>
                    </div>
                </div>-->
            </div>

                <table
                    id="table"
                    data-toolbar="#toolbar"
                    data-search="true"
                    data-show-refresh="true"
                    data-show-toggle="true"
                    data-show-fullscreen="true"
                    data-show-columns="true"
                    data-show-columns-toggle-all="true"
                    data-detail-view="false"
                    data-show-export="true"
                    data-click-to-select="true"
                    data-detail-formatter="detailFormatter"
                    data-minimum-count-columns="2"
                    data-show-pagination-switch="true"
                    data-pagination="true"
                    data-id-field="id"
                    data-page-list="[10, 25, 50, 100, all]"
                    data-show-footer="true"
                    data-response-handler="responseHandler">
                <thead>
                    <tr>
                        <th data-field="agentName" data-sortable="true">Driver Name</th>
                        <th data-field="datePod" data-sortable="true">POD Date</th>
                        <th data-field="services" data-sortable="true">Services</th>
                        <th data-field="trackingNumber" data-sortable="true">Tracking Number</th>
                        <th data-field="additionalDetails" data-sortable="true">Additional Details</th>
                        <th data-field="contactName" data-sortable="true">Contact Name</th>
                        <th data-field="contactAddress" data-sortable="true">Contact Address</th>
                        <th data-field="contactNumber" data-sortable="true" data-visible="false">Contact Number</th>
                        <th data-field="deliveryType" data-sortable="true" data-visible="false">Delivery Type</th>
                        <th data-field="value" data-sortable="true" data-visible="false">Value (BND)</th>
                        <th data-field="paymentMethod" data-sortable="true" data-visible="false">Payment Method</th>
                        <th data-field="remarks" data-sortable="true" data-visible="false">Remarks</th>
                        <th data-field="receivedby" data-sortable="true" data-visible="false">Received By</th>
                        
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="13" class="text-center">No Data</td>
                    </tr>
                </tbody>
            </table>
        
            <input type="hidden" class="form-control form-control-user" name="formMETHOD" id="formMETHOD" aria-describedby="contactHelp" value="POD">

        <!--<a href="index.html" class="btn btn-primary btn-user btn-block">Submit</a>-->
        </div>
    </form>
</div>
</div>
</div>
</div>

<script>
    let listing = '<%- JSON.stringify(list) %>'

    var $table = $('#table')
    var $remove = $('#remove')
    var selections = []
  
    function getIdSelections() {
        return $.map($table.bootstrapTable('getSelections'), function (row) {
            return row.id
        })
    }
  
    function responseHandler(res) {
        $.each(res.rows, function (i, row) {
            row.state = $.inArray(row.id, selections) !== -1
        })
        return res
    }
  
    function detailFormatter(index, row) {
        var html = []
        $.each(row, function (key, value) {
            html.push('<p><b>' + key + ':</b> ' + value + '</p>')
        })
        return html.join('')
    }
  
    function operateFormatter(value, row, index) {
        for(i=0; i < listing.length; i++){
        return [
            `<button class="btn btn-link dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="fa fa-ellipsis-h"></i>
            </button>`
            ,
            
                `<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <a class="dropdown-item" type="button" data-toggle="modal" data-target="#exampleModal${i}" href="#">Details</a>
            </div>`
            
        ].join('')
        }
    }
    
    /*
    window.operateEvents = {
        'click .like': function (e, value, row, index) {
            console.log('You click like action, row: ' + JSON.stringify(row))
        },
        'click .remove': function (e, value, row, index) {
            $table.bootstrapTable('remove', {
            field: 'id',
            values: [row.id]
            })
        }
    }*/
  
    // function totalTextFormatter(data) {
    //   return 'Total'
    // }
  
    // function totalNameFormatter(data) {
    //   return data.length
    // }
  
    // function totalPriceFormatter(data) {
    //   var field = this.field
    //   return '$' + data.map(function (row) {
    //     return +row[field].substring(1)
    //   }).reduce(function (sum, i) {
    //     return sum + i
    //   }, 0)
    // }
  
   var $table = $('#table')
   
  
    $(function() {
        
        //console.log(listing)
        var data = JSON.parse(listing) //testing required
        //console.log(data)
        for(i=0; i<data.length; i++){ //change the value to date
            let start = moment(data[i].dateEntry).format('MM/DD/YYYY')
            let end = moment().format('MM/DD/YYYY')
            console.log(new Date(end))
            console.log(moment(data[i].dateEntry).format('MM/DD/YYYY'))
            let dif = new Date(end) - new Date(start)
            let d = dif/(1000*3600*24)
            data[i].age = d +" days"
            console.log( data[i].age)

            let status = data[i].currentStatus
            if(status == "A2"){
                data[i].currentStatus = "IN MEDICINE ROOM"
            }

            let expire = moment(data[i].mohExpire).format('DD/MM/YYYY')
            data[i].mohExpire = expire
        }
        $table.bootstrapTable({data: data})
        $table.bootstrapTable('updateFormatText', 'formatShowingRows', 'Showing')
    })
  
  // Events
    $('.dropdown-container')
        .on('click', '.dropdown-button', function() {
            $(this).siblings('.dropdown-list').toggle();
        })
        .on('input', '.dropdown-search', function() {
            var target = $(this);
            var dropdownList = target.closest('.dropdown-list');
            var search = target.val().toLowerCase();
        
            if (!search) {
                dropdownList.find('li').show();
                return false;
            }
        
            dropdownList.find('li').each(function() {
                var text = $(this).text().toLowerCase();
                var match = text.indexOf(search) > -1;
                $(this).toggle(match);
            });
        })
        .on('change', '[type="checkbox"]', function() {
        var container = $(this).closest('.dropdown-container');
        var numChecked = container. find('[type="checkbox"]:checked').length;
        container.find('.quantity').text(numChecked || 'Any');
    });
  
    $(document).ready(function () {
        var seachHtml = "";
        var checkBoxIdNoPart = 0;
        $("table.table-bordered thead tr th div.th-inner").each(function () {
        checkBoxIdNoPart++;
        seachHtml +=
            '<input class="checkBoxClass"  value=' + checkBoxIdNoPart + ' type="checkbox">' 
        });

        $('.dropdown-list').append(seachHtml);

        $("#search_input").keyup(function () {
            var searchText = $(this).val().toLowerCase();
            // Show only matching TR, hide rest of them
            $.each(checkBoxValArray, function (index, value) {
                $.each($('#table tbody td:nth-child(' + value + ')'), function () {
                if ($(this).text().toLowerCase().indexOf(searchText) != -1)
                    $(this).parent().show();
                else
                    $(this).parent().hide();
                });
            });
        });

        var checkBoxValArray = [];
        $('.checkBoxClass').click(function () {
            checkBoxValArray.push($(this).val());
        });
    });
</script>